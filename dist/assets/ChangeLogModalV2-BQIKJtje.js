import{_ as q}from"./DstModal-CeXaOj72.js";import{s as v,i as o,F as f,Q as N,o as h,c as O,G as d,k as y,z as m,S as E,u as T,$ as G,e as w,j as K,b as u,p as g,h as A}from"./vendor-KxyM20Hl.js";import{K as L,M as z,az as F,aA as R,B as D,a as C}from"./override-BFaICR1o.js";import"./browser-polyfill-CXcayLWt.js";import"./ui-CLaKVJwO.js";function c(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!N(n)}const j={inline:{bold:"strong",code:"code",keyboard:"kbd",strikethrough:"s",italic:"em",link:"a",subscript:"sub",superscript:"sup",underline:"u",relationship:({data:n})=>o("span",null,[(n==null?void 0:n.label)||(n==null?void 0:n.id)])},block:{block:"div",blockquote:"blockquote",paragraph:({children:n,textAlign:s})=>o("p",{style:{textAlign:s}},[n]),divider:"hr",heading:({level:n,children:s,textAlign:l})=>{let r=`h${n}`;return o(r,{style:{textAlign:l}},c(s)?s:{default:()=>[s]})},code:"pre",list:({children:n,type:s})=>{let l;return o(s==="ordered"?"ol":"ul",null,c(l=n.map((r,t)=>o("li",{key:t},[r])))?l:{default:()=>[l]})},layout:({children:n,layout:s})=>o("div",{style:{display:"grid",gridTemplateColumns:s.map(l=>`${l}fr`).join(" ")}},[n.map((l,r)=>o("div",{key:r},[l]))])}};function S({node:n,componentBlocks:s,renderers:l}){if(typeof n.text=="string"){let e=o(f,null,[n.text]);return Object.keys(l.inline).forEach(a=>{if(a!=="link"&&a!=="relationship"&&n[a]){const i=l.inline[a],p=function(){return e}();e=o(i,null,c(e)?e:{default:()=>[p]})}}),e}const r=n,t=r.children.map((e,a)=>o(S,{node:e,componentBlocks:s,renderers:l,key:a},null));switch(r.type){case"blockquote":{const e=l.block.blockquote;return typeof e=="string"?o(e,null,c(t)?t:{default:()=>[t]}):typeof e=="function"?o(e,{children:t},c(t)?t:{default:()=>[t]}):o(f,null,null)}case"paragraph":return o(l.block.paragraph,{children:t,textAlign:r.textAlign},c(t)?t:{default:()=>[t]});case"code":{if(r.children.length===1&&r.children[0]&&typeof r.children[0].text=="string"){const e=r.children[0].text,a=l.block.code;if(typeof a=="string")return o(a,null,c(e)?e:{default:()=>[e]});if(typeof a=="function")return o(a,{children:e},c(e)?e:{default:()=>[e]})}break}case"layout":return o(l.block.layout,{layout:r.layout,children:t},c(t)?t:{default:()=>[t]});case"divider":{const e=l.block.divider;return typeof e=="string"||typeof e=="function"?o(e,null,null):o(f,null,null)}case"heading":return o(l.block.heading,{textAlign:r.textAlign,level:r.level,children:t},c(t)?t:{default:()=>[t]});case"component-block":{const e=s[r.component];if(e){const a=H(r,t),i=l.block.block;if(typeof i=="string")return o(i,null,{default:()=>[o(e,a,{default:()=>[a.children||null]})]});if(typeof i=="function")return o(i,{children:[o(e,null,null)]},{default:()=>[o(e,a,{default:()=>[a.children||null]})]})}break}case"ordered-list":case"unordered-list":return o(l.block.list,{children:t,type:r.type==="ordered-list"?"ordered":"unordered"},null);case"relationship":{const e=r.data;return o(l.inline.relationship,{relationship:r.relationship,data:e?{id:e.id,label:e.label,data:e.data}:null},null)}case"link":{const e=l.inline.link;if(typeof e=="string")return o(e,{href:r.href},c(t)?t:{default:()=>[t]});if(typeof e=="function")return o(e,{children:t[0],href:r.href},c(t)?t:{default:()=>[t]})}}return o(f,null,[t])}function V(n,s,l){if(s.length===1)n[s[0]]=l;else{let r=s.shift();V(n[r],s,l)}}function H(n,s){const l=JSON.parse(JSON.stringify(n.props));return n.children.forEach((r,t)=>{if(r.propPath){const e=[...r.propPath];V(l,e,s[t])}}),l}const J=v({render(){var n,s;const l={inline:{...j.inline,...(n=this.$props.renderers)==null?void 0:n.inline},block:{...j.block,...(s=this.$props.renderers)==null?void 0:s.block}},r=this.$props.componentBlocks??{};return this.$props.document.map((t,e)=>o(S,{node:t,componentBlocks:r,renderers:l,key:e},null))},props:{document:{type:Object,required:!0},renderers:{type:Object},componentBlocks:{type:Object}}}),P=v({__name:"KeystoneRenderer",props:{document:{},border:{type:Boolean}},setup(n){const s=n,l={button:({content:t,classes:e})=>{let a="btn my-2";if(e){const i=e.props.node,p=i.children?i.children[0].text:"";a+=` ${p}`}return o("div",{class:"flex justify-center"},[o("button",{class:a},[t])])}},r={block:{code:({children:t})=>o("div",{class:"flex justify-center items-center",innerHTML:t},null),layout:({children:t,layout:e})=>{let a="";return e.forEach(i=>a+=`${i}fr `),o("div",{class:"grid justify-center gap-2 items-center",style:{gridTemplateColumns:a}},[t])}},inline:{relationship({relationship:t,data:e}){return t==="image"?e===null||e.data===void 0?o(f,null,null):o("div",null,[o("img",{class:"rounded-lg inline-block my-2",src:e.data.image.url,alt:e.data.altText},null)]):null}}};return(t,e)=>(h(),O("div",{class:y(["renderer rounded-lg p-2",{bordered:s.border}])},[o(d(J),{document:s.document,renderers:r,"component-blocks":l},null,8,["document"])],2))}});function Q(){const n=m("");return E(()=>{try{n.value=chrome.runtime.getManifest().version}catch{n.value=""}}),{version:n}}const B="version_history",b={Set:async n=>await F(B,n),Get:async()=>await R(B)},$=async n=>{const s=await b.Get()??[],l=s.findIndex(r=>r.version===n.version);l>=0&&s.splice(l,1),await b.Set([...s,n])},Y=async n=>{const l=(await z.getInstance().axios.get("/cms/updates",{params:{appVersion:n,platform:"desktop"}})).data.data[0],r=await b.Get();let t=r==null?void 0:r.find(e=>e.version===l.versionCode);return t||(t={version:l.versionCode,changelog_visited:!1},await $(t)),{...l,changelog_visited:t.changelog_visited}},U=n=>{const{version:s}=Q();return L({queryKey:["new-app-version"],queryFn:()=>Y(s.value).then(l=>{var r;return(r=n==null?void 0:n.onSuccess)==null||r.call(n,l),l}),enabled:T(()=>!!s.value)})},W={class:"modal-content backdrop-blur-md !rounded-3xl !flex !flex-col !items-stretch !p-0 !text-secondary-800"},X={class:"p-5 text-center"},Z={class:"font-semibold text-base"},ee={class:"p-6 flex flex-col gap-4"},te={class:"!max-h-[70vh] overflow-auto no-scrollbar"},ne={key:0,class:"font-semibold text-base"},le=["disabled"],ce=v({__name:"ChangeLogModalV2",setup(n){const{t:s}=G(),l=m(!0),r=m(0),t=m(null),{data:e}=U({onSuccess(i){i.changelog_visited||(C("changeLogModal",{isOpen:!0}),r.value=0,l.value=!0,t.value=setInterval(()=>{r.value+=33,r.value>=99&&setTimeout(()=>{l.value=!1},1e3)},1e3))}});function a(){e.value&&($({version:e.value.versionCode,changelog_visited:!0}),C("changeLogModal",{isOpen:!1}),t.value&&(clearInterval(t.value),t.value=null))}return(i,p)=>{const M=P,I=q;return h(),w(I,{name:"changeLogModal","can-close":!1},{default:K(()=>{var k,_,x;return[u("div",W,[u("div",X,[u("p",Z,g(d(s)("change_log_modal.title")),1)]),p[0]||(p[0]=u("hr",{class:"!border-b !border-t-0 border-secondary-100"},null,-1)),u("div",ee,[u("div",te,[(k=d(e))!=null&&k.title?(h(),O("p",ne,g((_=d(e))==null?void 0:_.title),1)):A("",!0),(x=d(e))!=null&&x.content.document?(h(),w(M,{key:1,document:d(e).content.document},null,8,["document"])):A("",!0)]),u("button",{class:y(["btn btn-primary !text-sm !text-white flex items-center justify-center gap-x-2.5 py-3",{"opacity-50 cursor-not-allowed":l.value}]),disabled:l.value,onClick:a},[u("p",null,g(d(s)("change_log_modal.buttons.confirm")),1),o(d(D),{"completed-steps":r.value,"step-size":1,diameter:20,"stroke-width":3,"inner-stroke-width":3,"start-color":"white","stop-color":"white","inner-stroke-color":"#ffffff55","total-steps":100,class:y(l.value?"":"invisible")},null,8,["completed-steps","class"])],10,le)])])]}),_:1})}}});export{ce as default};
