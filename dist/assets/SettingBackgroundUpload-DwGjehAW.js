import{_ as E}from"./PlusBadge-DcXgy5Vx.js";import{_ as U}from"./SettingModal-CsxBn5nL.js";import{S as w,P as L,U as v,M,u as A,w as F,a as q,al as D,Z as K}from"./override-BFaICR1o.js";import{z as h,u as f,s as Q,$ as z,B as G,o as g,c as N,b as _,G as u,e as y,p as k,h as O}from"./vendor-KxyM20Hl.js";import"./star-group-BD8DRG6H.js";import"./ic-profile-3-C1dVKLA0.js";import"./DstModal-CeXaOj72.js";import"./ui-CLaKVJwO.js";import"./browser-polyfill-CXcayLWt.js";const x=h(0),P=h(!1),B=h(!1),b=h(!1),I=()=>{const o=e=>{x.value=e},s=e=>{P.value=e},a=e=>{B.value=e},t=()=>{b.value=!0},l=()=>{b.value=!1};return{progress:f(()=>x.value),isError:f(()=>P.value),isPending:f(()=>B.value),setIsError:s,setIsPending:a,setProgress:o,startLoading:t,stopLoading:l,isLoading:b}},R=async(o,s)=>{const a=new FormData;return a.append("image",o.image),(await M.getInstance().axios.post("/express/v2/users/data/background/upload",a,{onUploadProgress(e){var i;(i=s==null?void 0:s.onUploadProgress)==null||i.call(s,e)}})).data},T=()=>{const o=w(),{setProgress:s,setIsError:a,setIsPending:t}=I(),{mutate:l,isPending:e}=L({mutationFn:async m=>{t(!0),a(!1);const d=await R({image:m},{onUploadProgress(n){n.progress&&s(Math.trunc(n.progress*100))}});return t(!1),a(!1),d},onSuccess:()=>{o.invalidateQueries({queryKey:[v]})}});return{upload:(m,d)=>{l(m,{onSuccess:n=>{d(n.url),o.invalidateQueries({queryKey:[v]}),o.invalidateQueries({queryKey:["personal_backgrounds"]})},onError:n=>{t(!1),a(!0)}})},isLoading:e}},V={class:"text-secondary-500 text-xs font-semibold"},$={class:"text-secondary-400 text-xs font-medium"},j=["disabled"],te=Q({__name:"SettingBackgroundUpload",setup(o){const{membershipStatus:s}=A(),{t:a}=z(),t=f(()=>{var p,r,c;return!!((c=(r=(p=s.value)==null?void 0:p.currentMembership)==null?void 0:r.membershipLevel)!=null&&c.allowPersonalBackground)});function l(){t.value||q("plusModal",{isOpen:!0})}const{isError:e,isPending:i,progress:m}=I(),{upload:d}=T(),n=p=>{const r=p.target;!r.files||r.files.length===0||d(r.files[0],c=>{D({type:"image",name:"self",image:{id:-1,mainImage:c,thumbnail:c}})})};return G(e,()=>{e.value&&F.error("Failed to upload background")}),(p,r)=>{const c=K,S=U,C=E;return g(),N("div",null,[_("label",{onClick:l,class:"w-full bg-secondary-50 p-6 h-36 rounded-md relative flex flex-col items-center justify-center gap-y-3 border-2 border-dashed"},[u(i)?(g(),y(c,{key:0,class:"my-2","class-name":"bg-secondary-800"})):(g(),y(S,{key:1})),_("span",V,k(u(a)("upload_photo_from_computer")),1),_("span",$,k(u(a)("upload_photo_from_computer_description")),1),_("input",{accept:"image/*",onChange:n,id:"dropzone-file",type:"file",class:"hidden",disabled:!u(t)||u(i)},null,40,j),u(t)?O("",!0):(g(),y(C,{key:2,class:"absolute left-2 top-2"}))])])}}});export{te as default};
